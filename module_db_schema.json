{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PyTorch Module Analysis Schema",
  "description": "JSON Schema for storing PyTorch module FLOP and memory analysis functions. Uses ${Module}() for module references and {param} for parameters.",
  "type": "object",
  "properties": {
    "full_class_name": {
      "type": "string",
      "description": "Complete Python class name with full module path"
    },
    "code_location": {
      "type": "object",
      "description": "Source code location information",
      "properties": {
        "file": {
          "type": "string",
          "description": "Relative path to source file containing the class"
        },
        "line_start": {
          "type": "integer",
          "description": "Starting line number of forward method",
          "minimum": 1
        },
        "line_end": {
          "type": "integer",
          "description": "Ending line number of forward method",
          "minimum": 1
        }
      },
      "required": ["file", "line_start", "line_end"],
      "additionalProperties": false
    },
    "flop_analysis": {
      "type": "object",
      "description": "FLOP calculation analysis",
      "properties": {
        "thinking_process": {
          "type": "string",
          "description": "Step-by-step reasoning for FLOP calculation"
        },
        "parameters": {
          "type": "array",
          "description": "List of parameter objects needed for FLOP calculation",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Parameter name used in calculation formula"
              },
              "type": {
                "type": "string",
                "enum": ["int", "float", "str", "bool"],
                "description": "Parameter data type"
              },
              "description": {
                "type": "string",
                "description": "Human-readable parameter description"
              }
            },
            "required": ["name", "type", "description"],
            "additionalProperties": false
          }
        },
        "calculation_formula": {
          "type": "string",
          "description": "Calculation formula using {param} for parameters and ${Module}() for module references"
        },
        "module_depends": {
          "type": "array",
          "description": "List of module dependencies referenced in calculation formula",
          "items": {
            "type": "string"
          }
        },
        "breakdown": {
          "type": "object",
          "description": "FLOP breakdown by operation/submodule using calculation formula syntax",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "required": ["thinking_process", "parameters", "calculation_formula", "module_depends", "breakdown"],
      "additionalProperties": false
    },
    "memory_analysis": {
      "type": "object",
      "description": "Memory access pattern analysis",
      "properties": {
        "thinking_process": {
          "type": "string",
          "description": "Step-by-step reasoning for memory access patterns"
        },
        "parameters": {
          "type": "array",
          "description": "List of parameter objects needed for memory calculation",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Parameter name used in calculation formula"
              },
              "type": {
                "type": "string",
                "enum": ["int", "float", "str", "bool"],
                "description": "Parameter data type"
              },
              "description": {
                "type": "string",
                "description": "Human-readable parameter description"
              }
            },
            "required": ["name", "type", "description"],
            "additionalProperties": false
          }
        },
        "reads_calculation_formula": {
          "type": "string",
          "description": "Calculation formula for memory reads using {param} for parameters and ${Module}() for module references"
        },
        "writes_calculation_formula": {
          "type": "string",
          "description": "Calculation formula for memory writes using {param} for parameters and ${Module}() for module references"
        },
        "intermediates_calculation_formula": {
          "type": "string",
          "description": "Calculation formula for intermediate memory using {param} for parameters and ${Module}() for module references"
        },
        "module_depends": {
          "type": "array",
          "description": "List of module dependencies referenced in memory calculation formulas",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["thinking_process", "parameters", "reads_calculation_formula", "writes_calculation_formula", "intermediates_calculation_formula", "module_depends"],
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "description": "Validation status and metadata",
      "properties": {
        "human_validated": {
          "type": "boolean",
          "description": "Whether the analysis has been validated by a human"
        }
      },
      "required": ["human_validated"],
      "additionalProperties": false
    },
    "generated_file_name": {
      "type": "string",
      "description": "Actual generated filename (e.g., 'transformers_llama_rms_norm.py')"
    },
    "generated_class_name": {
      "type": "string",
      "description": "Actual generated class name (e.g., 'TransformersLlamaRMSNorm')"
    }
  },
  "required": ["full_class_name", "code_location", "flop_analysis", "memory_analysis", "validation"],
  "additionalProperties": false
}